<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Financiero - Multi-Negocio (Corregido)</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
    
    <!-- Dependencias externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Conexi√≥n con Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Nuestros archivos locales -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="p-2 sm:p-4 md:p-8">

    <!-- Overlay de Login -->
    <div id="login-overlay" class="auth-overlay hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-2xl w-full max-w-sm mx-4">
            <div class="text-center mb-6">
                <i class="fas fa-store text-4xl text-indigo-600"></i>
                <h2 class="text-2xl font-bold text-gray-800 mt-4">Acceso al Sistema</h2>
                <p class="text-gray-500 text-sm">Por favor, inicie sesi√≥n.</p>
            </div>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="sr-only">Correo Electr√≥nico</label>
                    <input type="email" id="email" placeholder="Correo Electr√≥nico" class="w-full px-4 py-3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                </div>
                <div class="mb-4">
                    <label for="password" class="sr-only">Contrase√±a</label>
                    <input type="password" id="password" placeholder="Contrase√±a" class="w-full px-4 py-3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" required>
                </div>
                <p id="login-error" class="text-red-500 text-sm text-center mb-4 hidden"></p>
                <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">Ingresar</button>
            </form>
        </div>
    </div>

    <!-- Overlay Selector de Negocio -->
    <div id="business-selector-overlay" class="auth-overlay hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-40 flex items-center justify-center p-4">
        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 text-center">Seleccionar Negocio</h2>
            <p class="text-gray-500 text-sm text-center mb-6">Elige el local que deseas gestionar.</p>
            <div id="business-list" class="space-y-3">
            </div>
            <div class="mt-6 text-center">
                 <button id="logout-btn-selector" class="text-sm text-gray-600 hover:text-indigo-600">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </div>
    
    <!-- Contenedor Principal de la App -->
    <div id="app-container" class="hidden">
        <div class="max-w-7xl mx-auto">
            <header class="relative text-center mb-4 no-print">
                <h1 id="app-title" class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800">üìä Gesti√≥n Financiera</h1>
                <p class="text-gray-600 mt-2 text-sm sm:text-base">Control de Flujo de Dinero, Compras, Gastos y Deudas.</p>
                <div class="absolute top-0 right-0 flex items-center space-x-2">
                    <button id="switch-business-btn" class="hidden action-button text-gray-500 hover:text-indigo-600 text-xl sm:text-2xl" title="Cambiar de Negocio">
                        <i class="fas fa-exchange-alt"></i>
                    </button>
                    <button id="logout-btn-main" class="action-button text-gray-500 hover:text-red-600 text-xl sm:text-2xl" title="Cerrar Sesi√≥n">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>

            <!-- Navegaci√≥n por Pesta√±as -->
            <div class="border-b border-gray-200 mb-4 sm:mb-6 no-print overflow-x-auto">
                <nav id="tabs-nav" class="-mb-px flex space-x-2 sm:space-x-6 min-w-max" aria-label="Tabs">
                    <button data-tab="resumen" data-emoji="üìä" class="tab-button active whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-chart-pie mr-1 sm:mr-2"></i><span class="tab-text">Resumen</span>
                    </button>
                    <button data-tab="ingresos" data-emoji="üí∞" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-dollar-sign mr-1 sm:mr-2"></i><span class="tab-text">Ingreso</span>
                    </button>
                    <button data-tab="compras" data-emoji="üõí" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-shopping-cart mr-1 sm:mr-2"></i><span class="tab-text">Compras</span>
                    </button>
                    <button data-tab="gastos" data-emoji="üßæ" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-receipt mr-1 sm:mr-2"></i><span class="tab-text">Gasto Op.</span>
                    </button>
                    <button data-tab="retiros" data-emoji="üí∏" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-hand-holding-dollar mr-1 sm:mr-2"></i><span class="tab-text">Retiro Jefe</span>
                    </button>
                    <button data-tab="deudas" data-emoji="üìö" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-book mr-1 sm:mr-2"></i><span class="tab-text">Deudas</span>
                    </button>
                    <button data-tab="vales" data-emoji="üè∑Ô∏è" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-user-tag mr-1 sm:mr-2"></i><span class="tab-text">Vales</span>
                    </button>
                    <button data-tab="terceros" data-emoji="üë•" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-users mr-1 sm:mr-2"></i><span class="tab-text">Terceros</span>
                    </button>
                    <button data-tab="registros" data-emoji="üìã" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-list-ul mr-1 sm:mr-2"></i><span class="tab-text">Ver Registros</span>
                    </button>
                    <button data-tab="historial" data-emoji="üóÑÔ∏è" class="tab-button whitespace-nowrap py-3 sm:py-4 px-1 sm:px-2 border-b-2 font-medium text-xs sm:text-sm">
                        <i class="fas fa-archive mr-1 sm:mr-2"></i><span class="tab-text">Historial</span>
                    </button>
                </nav>
            </div>

            <!-- Contenido de las Pesta√±as -->
            <main>
                <!-- Pesta√±a: Resumen -->
                <div id="resumen" class="tab-content">
                    <div id="print-area">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4">
                            <div>
                                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700">Resumen del Periodo</h2>
                                <p id="period-display" class="text-xs sm:text-sm text-gray-500 mt-1">Calculando periodo...</p>
                                <div id="period-status" class="hidden mt-2 px-3 py-1 rounded-full text-xs sm:text-sm font-medium">
                                    <i class="fas fa-lock mr-1"></i>üîí PER√çODO CERRADO - Solo consulta
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 w-full sm:w-auto no-print">
                                <input type="month" id="month-filter" class="p-2 border border-gray-300 rounded-md text-sm">
                                <button id="close-period-btn" class="bg-indigo-600 text-white font-semibold px-3 sm:px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-xs sm:text-sm">
                                    <i class="fas fa-calendar-check mr-1 sm:mr-2"></i><span class="hidden sm:inline">Realizar </span>Corte de Mes
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-6 sm:mb-8">
                            <div class="card p-3 sm:p-5"><h3 class="text-gray-500 text-xs sm:text-sm font-medium">Ingresos Totales (Periodo)</h3><p id="total-ingresos" class="text-lg sm:text-2xl font-semibold text-green-600 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5"><h3 class="text-gray-500 text-xs sm:text-sm font-medium">Compras Totales (Periodo)</h3><p id="total-compras" class="text-lg sm:text-2xl font-semibold text-purple-600 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5"><h3 class="text-gray-500 text-xs sm:text-sm font-medium">Gastos Op. Totales (Periodo)</h3><p id="total-gastos-op" class="text-lg sm:text-2xl font-semibold text-red-600 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5"><h3 class="text-gray-500 text-xs sm:text-sm font-medium">Retiros del Jefe (Periodo)</h3><p id="total-retiros" class="text-lg sm:text-2xl font-semibold text-orange-500 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5 bg-blue-50 border-blue-200 border"><h3 class="text-blue-800 text-xs sm:text-sm font-medium">Efectivo en Caja (Actual)</h3><p id="efectivo-caja" class="text-lg sm:text-2xl font-semibold text-blue-700 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5" style="background-color: #fde6f3; border-color: #e83e8c;"><h3 class="text-xs sm:text-sm font-medium" style="color: #8c2552;">Saldo en Nequi (Actual)</h3><p id="saldo-nequi" class="text-lg sm:text-2xl font-semibold mt-1" style="color: #e83e8c;">$0</p></div>
                            <div class="card p-3 sm:p-5 bg-green-50 border-green-200 border"><h3 class="text-green-800 text-xs sm:text-sm font-medium">Saldo en Banco (Actual)</h3><p id="saldo-banco" class="text-lg sm:text-2xl font-semibold text-green-700 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5 bg-yellow-50 border-yellow-200 border"><h3 class="text-yellow-800 text-xs sm:text-sm font-medium">Cuentas por Cobrar</h3><p id="cuentas-cobrar-total" class="text-lg sm:text-2xl font-semibold text-yellow-700 mt-1">$0</p></div>
                            <div class="card p-3 sm:p-5 bg-red-50 border-red-200 border"><h3 class="text-red-800 text-xs sm:text-sm font-medium">Cuentas por Pagar</h3><p id="cuentas-pagar-total" class="text-lg sm:text-2xl font-semibold text-red-700 mt-1">$0</p></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 sm:gap-8">
                            <div class="lg:col-span-2 card p-4 sm:p-6"><h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-4">Distribuci√≥n de Gastos (Periodo)</h3><canvas id="gastos-chart"></canvas></div>
                            <div class="lg:col-span-3 card p-4 sm:p-6"><h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-4">√öltimos Movimientos (Global)</h3><div class="overflow-x-auto"><table class="w-full text-xs sm:text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-3 sm:px-6 py-3">Fecha</th><th class="px-3 sm:px-6 py-3">Descripci√≥n</th><th class="px-3 sm:px-6 py-3">Monto</th></tr></thead><tbody id="ultimos-movimientos-body"></tbody></table></div></div>
                        </div>
                    </div>
                </div>

                <!-- Pesta√±a: Ingresos -->
                <div id="ingresos" class="tab-content hidden">
                    <div class="max-w-xl mx-auto card p-6 sm:p-8">
                        <h2 class="text-xl sm:text-2xl font-semibold">Registrar Venta</h2>
                        <form id="form-ingresos" class="space-y-4 sm:space-y-6">
                            <div>
                                <label for="ingreso-fecha" class="block text-sm font-medium">Fecha de la Venta</label>
                                <input type="date" id="ingreso-fecha" class="mt-1 block w-full rounded-md" required>
                                <p class="text-xs text-gray-500 mt-1">La venta se registrar√° en el per√≠odo contable activo.</p>
                            </div>
                            <div>
                                <label for="ingreso-efectivo" class="block text-sm font-medium">Ventas en Efectivo</label>
                                <input type="text" data-moneda inputmode="numeric" id="ingreso-efectivo" value="0" class="mt-1 block w-full" required>
                            </div>
                            <div>
                                <label for="ingreso-nequi" class="block text-sm font-medium" style="color: #8c2552;">Ventas por Nequi</label>
                                <input type="text" data-moneda inputmode="numeric" id="ingreso-nequi" value="0" class="mt-1 block w-full rounded-md" style="border-color: #e83e8c; --tw-ring-color: #e83e8c;" required>
                            </div>
                            <div>
                                <label for="ingreso-tarjeta" class="block text-sm font-medium">Ventas Tarjeta/Transf. (Banco)</label>
                                <input type="text" data-moneda inputmode="numeric" id="ingreso-tarjeta" value="0" class="mt-1 block w-full" required>
                            </div>
                            <div>
                                <label for="ingreso-sobrante" class="block text-sm font-medium text-blue-600">Sobrantes del D√≠a (en Efectivo)</label>
                                <input type="text" data-moneda inputmode="numeric" id="ingreso-sobrante" value="0" class="mt-1 block w-full rounded-md border-blue-300 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label for="ingreso-notas" class="block text-sm font-medium">Notas</label>
                                <textarea id="ingreso-notas" rows="3" class="mt-1 block w-full"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold">A√±adir Ingreso</button>
                        </form>
                    </div>
                </div>
                
                <!-- Otras pesta√±as (Compras, Gastos, etc.) -->
                <div id="compras" class="tab-content hidden"><div class="max-w-xl mx-auto card p-6 sm:p-8"><h2 class="text-xl sm:text-2xl font-semibold">Registrar Compra</h2><form id="form-compras" class="space-y-4 sm:space-y-6"><div><label for="compra-fecha" class="block text-sm font-medium">Fecha de la Compra</label><input type="date" id="compra-fecha" class="mt-1 block w-full" required><p class="text-xs text-gray-500 mt-1">La compra se registrar√° en el per√≠odo contable activo.</p></div><div><label for="compra-proveedor" class="block text-sm font-medium">Proveedor</label><input type="text" id="compra-proveedor" class="mt-1 block w-full" required></div><div><label for="compra-descripcion" class="block text-sm font-medium">Descripci√≥n</label><input type="text" id="compra-descripcion" class="mt-1 block w-full" required></div><div><label for="compra-monto" class="block text-sm font-medium">Monto</label><input type="text" data-moneda inputmode="numeric" id="compra-monto" class="mt-1 block w-full" required></div><div><label for="compra-metodo" class="block text-sm font-medium">Pagado con</label><select id="compra-metodo" class="mt-1 block w-full" required><option value="Efectivo">Efectivo</option><option value="Nequi">Nequi</option><option value="Banco">Banco</option></select></div><button type="submit" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold">A√±adir Compra</button></form></div></div>
                <div id="gastos" class="tab-content hidden"><div class="max-w-xl mx-auto card p-6 sm:p-8"><h2 class="text-xl sm:text-2xl font-semibold">Registrar Gasto Op. (del Efectivo)</h2><form id="form-gastos" class="space-y-4 sm:space-y-6"><div><label for="gasto-fecha" class="block text-sm font-medium">Fecha del Gasto</label><input type="date" id="gasto-fecha" class="mt-1 block w-full" required><p class="text-xs text-gray-500 mt-1">El gasto se registrar√° en el per√≠odo contable activo.</p></div><div><label for="gasto-descripcion" class="block text-sm font-medium">Descripci√≥n</label><input type="text" id="gasto-descripcion" class="mt-1 block w-full" required></div><div><label for="gasto-categoria" class="block text-sm font-medium">Categor√≠a</label><select id="gasto-categoria" class="mt-1 block w-full" required><option>Arriendo</option><option>Servicios</option><option>N√≥mina</option><option>Vales a Personal</option><option>Marketing</option><option>Mantenimiento</option><option>Impuestos</option><option>Insumos</option><option>Otro</option></select></div><div><label for="gasto-monto" class="block text-sm font-medium">Monto</label><input type="text" data-moneda inputmode="numeric" id="gasto-monto" class="mt-1 block w-full" required></div><button type="submit" class="w-full bg-red-600 text-white py-3 px-4 rounded-lg font-semibold">A√±adir Gasto</button></form></div></div>
                <div id="retiros" class="tab-content hidden"><div class="max-w-xl mx-auto card p-6 sm:p-8"><h2 class="text-xl sm:text-2xl font-semibold">Registrar Retiro Jefe</h2><form id="form-retiros" class="space-y-4 sm:space-y-6"><div><label for="retiro-fecha" class="block text-sm font-medium">Fecha del Retiro</label><input type="date" id="retiro-fecha" class="mt-1 block w-full" required><p class="text-xs text-gray-500 mt-1">El retiro se registrar√° en el per√≠odo contable activo.</p></div><div><label for="retiro-metodo" class="block text-sm font-medium">Retirar de</label><select id="retiro-metodo" class="mt-1 block w-full" required><option value="Efectivo">Efectivo (Caja)</option><option value="Nequi">Nequi</option><option value="Banco">Banco (Transferencia)</option></select></div><div><label for="retiro-descripcion" class="block text-sm font-medium">Descripci√≥n</label><input type="text" id="retiro-descripcion" class="mt-1 block w-full" required></div><div><label for="retiro-monto" class="block text-sm font-medium">Monto</label><input type="text" data-moneda inputmode="numeric" id="retiro-monto" class="mt-1 block w-full" required></div><button type="submit" class="w-full bg-orange-500 text-white py-3 px-4 rounded-lg font-semibold">A√±adir Retiro</button></form></div></div>
                <div id="deudas" class="tab-content hidden grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8">
                    <div class="space-y-4 sm:space-y-6">
                        <h2 class="text-xl sm:text-2xl font-semibold">Cuentas por Cobrar (Fiado)</h2>
                        <div class="card p-4 sm:p-6">
                            <form id="form-cuentas-cobrar" class="space-y-4">
                                <div class="flex items-end gap-2">
                                    <div class="flex-grow">
                                        <label for="cpc-tercero" class="block text-sm font-medium">Cliente</label>
                                        <select id="cpc-tercero" class="mt-1 block w-full" required></select>
                                    </div>
                                    <button type="button" id="btn-nuevo-cpc" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300 flex-shrink-0" title="Nuevo Cliente">+ Nuevo</button>
                                </div>
                                <div>
                                    <label for="cpc-descripcion" class="block text-sm font-medium">Descripci√≥n</label>
                                    <input type="text" id="cpc-descripcion" class="mt-1 block w-full" required>
                                </div>
                                <div>
                                    <label for="cpc-monto" class="block text-sm font-medium">Monto</label>
                                    <input type="text" data-moneda inputmode="numeric" id="cpc-monto" class="mt-1 block w-full" required>
                                </div>
                                <button type="submit" class="w-full bg-yellow-500 text-white py-2 rounded-lg font-semibold">A√±adir a Deuda</button>
                            </form>
                        </div>
                        <div class="card p-3 sm:p-4 overflow-x-auto">
                            <table class="w-full text-xs sm:text-sm" id="tabla-cuentas-cobrar"></table>
                        </div>
                    </div>
                    <div class="space-y-4 sm:space-y-6">
                        <h2 class="text-xl sm:text-2xl font-semibold">Cuentas por Pagar</h2>
                        <div class="card p-4 sm:p-6">
                            <form id="form-cuentas-pagar" class="space-y-4">
                                <div class="flex items-end gap-2">
                                    <div class="flex-grow">
                                        <label for="cpp-tercero" class="block text-sm font-medium">Proveedor/Acreedor</label>
                                        <select id="cpp-tercero" class="mt-1 block w-full" required></select>
                                    </div>
                                     <button type="button" id="btn-nuevo-cpp" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300 flex-shrink-0" title="Nuevo Proveedor">+ Nuevo</button>
                                </div>
                                <div>
                                    <label for="cpp-descripcion" class="block text-sm font-medium">Concepto</label>
                                    <input type="text" id="cpp-descripcion" class="mt-1 block w-full" required>
                                </div>
                                <div>
                                    <label for="cpp-monto" class="block text-sm font-medium">Monto</label>
                                    <input type="text" data-moneda inputmode="numeric" id="cpp-monto" class="mt-1 block w-full" required>
                                </div>
                                <button type="submit" class="w-full bg-red-500 text-white py-2 rounded-lg font-semibold">A√±adir a Cuenta por Pagar</button>
                            </form>
                        </div>
                        <div class="card p-3 sm:p-4 overflow-x-auto">
                            <table class="w-full text-xs sm:text-sm" id="tabla-cuentas-pagar"></table>
                        </div>
                    </div>
                </div>

                <div id="vales" class="tab-content hidden">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6">Control de Vales (Personal y Due√±o)</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-8">
                            <div class="md:col-span-1 space-y-4 sm:space-y-6">
                                <div class="card p-4 sm:p-6">
                                    <h3 class="text-base sm:text-lg font-semibold mb-4">Registrar Nuevo Vale</h3>
                                    <form id="form-vales" class="space-y-4">
                                        <div class="flex items-end gap-2">
                                            <div class="flex-grow">
                                                <label for="vale-tercero" class="block text-sm font-medium">Nombre Persona</label>
                                                <select id="vale-tercero" class="mt-1 block w-full" required></select>
                                            </div>
                                            <button type="button" id="btn-nuevo-vale" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300 flex-shrink-0" title="Nuevo Empleado">+ Nuevo</button>
                                        </div>
                                        <div>
                                            <label for="vale-descripcion" class="block text-sm font-medium">Descripci√≥n</label>
                                            <input type="text" id="vale-descripcion" class="mt-1 block w-full" required>
                                        </div>
                                        <div>
                                            <label for="vale-monto" class="block text-sm font-medium">Monto</label>
                                            <input type="text" data-moneda inputmode="numeric" id="vale-monto" class="mt-1 block w-full" required>
                                        </div>
                                        <button type="submit" class="w-full bg-cyan-600 text-white py-2 rounded-lg font-semibold hover:bg-cyan-700">A√±adir Vale</button>
                                    </form>
                                </div>
                            </div>
                            <div class="md:col-span-2 card p-3 sm:p-4 overflow-x-auto">
                                <h3 class="text-base sm:text-lg font-semibold mb-4 px-2">Historial de Vales</h3>
                                <table class="w-full text-xs sm:text-sm" id="tabla-vales"></table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pesta√±a: Terceros -->
                <div id="terceros" class="tab-content hidden">
                    <div class="max-w-4xl mx-auto">
                        <h2 class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6">Gesti√≥n de Terceros</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-8">
                            <div class="md:col-span-1 space-y-4 sm:space-y-6">
                                <div class="card p-4 sm:p-6">
                                    <h3 class="text-base sm:text-lg font-semibold mb-4">Crear Nuevo Tercero</h3>
                                    <form id="form-terceros" class="space-y-4">
                                        <div>
                                            <label for="tercero-nombre" class="block text-sm font-medium">Nombre Completo</label>
                                            <input type="text" id="tercero-nombre" class="mt-1 block w-full" required>
                                        </div>
                                        <div>
                                            <label for="tercero-tipo" class="block text-sm font-medium">Tipo</label>
                                            <select id="tercero-tipo" class="mt-1 block w-full" required>
                                                <option value="empleado">Empleado</option>
                                                <option value="cliente">Cliente</option>
                                                <option value="proveedor">Proveedor / Acreedor</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700">Guardar Tercero</button>
                                    </form>
                                </div>
                            </div>
                            <div class="md:col-span-2 card p-3 sm:p-4 overflow-x-auto">
                                <h3 class="text-base sm:text-lg font-semibold mb-4 px-2">Lista de Terceros</h3>
                                <table class="w-full text-xs sm:text-sm" id="tabla-terceros"></table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="registros" class="tab-content hidden space-y-6 sm:space-y-8">
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold">Todos los Ingresos</h2><button data-type="ingresos" class="btn-pdf bg-gray-700 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-ingresos"></table></div></div>
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold">Todos los Sobrantes</h2><button data-type="sobrantes" class="btn-pdf bg-blue-700 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-sobrantes"></table></div></div>
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold" style="color: #8c2552;">Movimientos de Nequi</h2><button data-type="nequi" class="btn-pdf text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm" style="background-color: #e83e8c;"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-nequi"></table></div></div>
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold">Todas las Compras</h2><button data-type="compras" class="btn-pdf bg-gray-700 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-compras"></table></div></div>
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold">Todos los Gastos Op.</h2><button data-type="gastos" class="btn-pdf bg-gray-700 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-gastos"></table></div></div>
                    <div><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2"><h2 class="text-xl sm:text-2xl font-semibold">Todos los Retiros</h2><button data-type="retiros" class="btn-pdf bg-gray-700 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm"><i class="fas fa-file-pdf mr-1 sm:mr-2"></i>PDF</button></div><div class="card p-3 sm:p-4 overflow-x-auto"><table class="w-full text-xs sm:text-sm" id="tabla-retiros"></table></div></div>
                    <div class="pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl sm:text-2xl font-semibold">Reportes Avanzados</h2>
                        </div>
                        <div class="card p-4 sm:p-6 space-y-4">
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-4 gap-2">
                                <div>
                                    <p class="font-medium text-gray-800">Resumen de Cuentas por Cobrar</p>
                                    <p class="text-xs sm:text-sm text-gray-500">Genera un PDF con el detalle de lo que te deben los clientes.</p>
                                </div>
                                <button data-type="deudas-cobrar" class="btn-pdf bg-yellow-500 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex-shrink-0"><i class="fas fa-download mr-1 sm:mr-2"></i>Descargar PDF</button>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-4 gap-2">
                                <div>
                                    <p class="font-medium text-gray-800">Resumen de Vales de Personal</p>
                                    <p class="text-xs sm:text-sm text-gray-500">Genera un PDF con el detalle de los vales de consumo interno.</p>
                                </div>
                                <button data-type="vales" class="btn-pdf bg-cyan-600 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex-shrink-0"><i class="fas fa-download mr-1 sm:mr-2"></i>Descargar PDF</button>
                            </div>
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2">
                                <div>
                                    <p class="font-medium text-gray-800">Resumen de Cuentas por Pagar</p>
                                    <p class="text-xs sm:text-sm text-gray-500">Genera un PDF con el detalle de tus deudas a proveedores.</p>
                                </div>
                                <button data-type="deudas-pagar" class="btn-pdf bg-red-500 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm flex-shrink-0"><i class="fas fa-download mr-1 sm:mr-2"></i>Descargar PDF</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="historial" class="tab-content hidden">
                    <div class="max-w-6xl mx-auto card p-6 sm:p-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-xl sm:text-2xl font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-archive mr-3 text-indigo-600"></i>
                                    Historial de Per√≠odos Cerrados
                                </h2>
                                <p class="text-sm text-gray-600 mt-2">Consulta los datos archivados de per√≠odos anteriores</p>
                            </div>
                            <button id="refresh-historial-btn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm">
                                <i class="fas fa-sync-alt mr-2"></i>Actualizar
                            </button>
                        </div>
                        <div class="mb-8">
                            <h3 class="text-lg font-medium mb-4 text-gray-700 flex items-center">
                                <i class="fas fa-calendar-alt mr-2 text-gray-500"></i>
                                Per√≠odos Archivados Disponibles:
                            </h3>
                            <div id="historial-periodos-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            </div>
                        </div>
                        <div id="historial-data-view" class="hidden">
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modales de la Aplicaci√≥n -->
    <div id="corte-mes-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-75 h-full w-full hidden z-50 flex items-center justify-center p-2 sm:p-4">
        <div class="relative mx-auto border w-full max-w-4xl shadow-2xl rounded-lg bg-white overflow-hidden max-h-screen overflow-y-auto">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-4 sm:px-8 py-4 sm:py-6 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 sm:space-x-3">
                        <i class="fas fa-calendar-check text-xl sm:text-2xl"></i>
                        <h3 class="text-lg sm:text-2xl font-bold">Corte de Mes</h3>
                    </div>
                    <button id="close-corte-modal-btn" class="text-white hover:text-gray-200 text-xl sm:text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <p class="mt-2 text-indigo-100 text-sm">Cierre contable del per√≠odo actual</p>
            </div>
            <div class="p-4 sm:p-8">
                <div id="corte-step-1" class="corte-step">
                    <div class="text-center mb-6 sm:mb-8">
                        <div class="inline-flex items-center justify-center w-12 sm:w-16 h-12 sm:h-16 bg-indigo-100 rounded-full mb-4">
                            <i class="fas fa-cog text-indigo-600 text-xl sm:text-2xl"></i>
                        </div>
                        <h4 class="text-lg sm:text-xl font-semibold text-gray-800">Configuraci√≥n del Corte</h4>
                        <p class="text-gray-600 mt-2 text-sm">Define los par√°metros para el cierre del per√≠odo</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Per√≠odo a Cerrar</label>
                                <input type="month" id="corte-periodo" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Corte</label>
                                <input type="date" id="corte-fecha" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Notas del Corte</label>
                            <textarea id="corte-notas" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Observaciones sobre el cierre del per√≠odo..."></textarea>
                        </div>
                    </div>
                    <div class="mt-6 sm:mt-8 flex justify-end">
                        <button id="corte-next-step1" class="bg-indigo-600 text-white px-4 sm:px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors text-sm sm:text-base">
                            Continuar <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
                <div id="corte-step-2" class="corte-step hidden">
                    <div class="text-center mb-6 sm:mb-8">
                        <div class="inline-flex items-center justify-center w-12 sm:w-16 h-12 sm:h-16 bg-yellow-100 rounded-full mb-4">
                            <i class="fas fa-eye text-yellow-600 text-xl sm:text-2xl"></i>
                        </div>
                        <h4 class="text-lg sm:text-xl font-semibold text-gray-800">Vista Previa del Corte</h4>
                        <p class="text-gray-600 mt-2 text-sm">Revisa los datos antes de proceder</p>
                    </div>
                    <div id="corte-preview-content" class="mb-6 sm:mb-8">
                    </div>
                    <div class="flex flex-col sm:flex-row justify-between items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                        <button id="corte-back-step2" class="bg-gray-500 text-white px-4 sm:px-6 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors text-sm sm:text-base">
                            <i class="fas fa-arrow-left mr-2"></i>Volver
                        </button>
                        <button id="corte-confirm" class="bg-red-600 text-white px-4 sm:px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors text-sm sm:text-base">
                            <i class="fas fa-check mr-2"></i>Confirmar y Archivar
                        </button>
                    </div>
                </div>
                <div id="corte-step-3" class="corte-step hidden">
                    <div class="text-center mb-6 sm:mb-8">
                        <div class="inline-flex items-center justify-center w-12 sm:w-16 h-12 sm:h-16 bg-blue-100 rounded-full mb-4">
                            <i class="fas fa-cogs text-blue-600 text-xl sm:text-2xl animate-spin"></i>
                        </div>
                        <h4 class="text-lg sm:text-xl font-semibold text-gray-800">Procesando Corte</h4>
                        <p class="text-gray-600 mt-2 text-sm">Por favor espera mientras se completa el proceso de archivado.</p>
                    </div>
                    <div class="mb-6">
                        <div class="bg-gray-200 rounded-full h-3 mb-4">
                            <div id="corte-progress-bar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p id="corte-progress-text" class="text-center text-sm text-gray-600">Iniciando proceso...</p>
                    </div>
                    <div id="corte-steps-list" class="space-y-2 max-h-64 overflow-y-auto">
                    </div>
                </div>
                <div id="corte-step-4" class="corte-step hidden">
                    <div class="text-center mb-6 sm:mb-8">
                        <div class="inline-flex items-center justify-center w-12 sm:w-16 h-12 sm:h-16 bg-green-100 rounded-full mb-4">
                            <i class="fas fa-check-circle text-green-600 text-xl sm:text-2xl"></i>
                        </div>
                        <h4 class="text-lg sm:text-xl font-semibold text-gray-800">Corte Completado y Archivado</h4>
                        <p class="text-gray-600 mt-2 text-sm">El proceso se ha ejecutado exitosamente.</p>
                    </div>
                    <div id="corte-summary" class="mb-6 sm:mb-8 p-4 bg-green-50 border border-green-200 rounded-lg">
                    </div>
                    <div class="flex flex-col sm:flex-row justify-center items-stretch sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                        <button id="corte-download-report" class="bg-blue-600 text-white px-4 sm:px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors text-sm sm:text-base">
                            <i class="fas fa-download mr-2"></i>Descargar Reporte
                        </button>
                        <button id="corte-close-modal-final" class="bg-gray-600 text-white px-4 sm:px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors text-sm sm:text-base">
                            <i class="fas fa-times mr-2"></i>Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="abono-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4"><div class="relative mx-auto p-6 sm:p-8 border w-full max-w-md shadow-lg rounded-md bg-white"><h3 class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6" id="abono-modal-title">Registrar Abono</h3><form id="form-abono"><input type="hidden" id="abono-deuda-id"><input type="hidden" id="abono-type"><div class="mb-4"><label class="block text-sm font-medium">Monto a Abonar</label><input type="text" data-moneda inputmode="numeric" id="abono-monto" class="mt-1 block w-full" required></div><div class="mb-4"><label class="block text-sm font-medium">Recibido en</label><select id="abono-metodo" class="mt-1 block w-full" required><option value="Efectivo">Efectivo</option><option value="Nequi">Nequi</option><option value="Banco">Banco</option></select></div></form><div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center mt-4 sm:mt-6 space-y-2 sm:space-y-0 sm:space-x-4"><button id="cancel-abono-btn" class="px-4 py-2 bg-gray-200 rounded-md text-sm sm:text-base">Cancelar</button><button id="save-abono-btn" class="px-4 py-2 bg-green-600 text-white rounded-md text-sm sm:text-base">Registrar Abono</button></div></div></div>
    <div id="notification-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4"><div class="relative mx-auto p-4 sm:p-5 border w-full max-w-sm sm:max-w-md shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><div id="notification-icon" class="mx-auto flex items-center justify-center h-10 sm:h-12 w-10 sm:w-12 rounded-full"></div><h3 id="notification-title" class="text-base sm:text-lg leading-6 font-medium text-gray-900 mt-2"></h3><div class="mt-2 px-4 sm:px-7 py-3"><p id="notification-message" class="text-xs sm:text-sm text-gray-500"></p></div><div class="items-center px-4 py-3"><button id="notification-close" class="px-4 py-2 bg-indigo-500 text-white text-sm sm:text-base font-medium rounded-md w-full">Cerrar</button></div></div></div></div>
    <div id="confirm-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4"><div class="relative mx-auto p-4 sm:p-5 border w-full max-w-sm sm:max-w-md shadow-lg rounded-md bg-white"><div class="mt-3 text-center"><div class="mx-auto flex items-center justify-center h-10 sm:h-12 w-10 sm:w-12 rounded-full bg-red-100"><i class="fas fa-exclamation-triangle text-red-600 text-lg sm:text-2xl"></i></div><h3 id="confirm-title" class="text-base sm:text-lg leading-6 font-medium text-gray-900 mt-4"></h3><div id="confirm-message-container" class="mt-2 px-4 sm:px-7 py-3"><p id="confirm-message" class="text-xs sm:text-sm text-gray-500"></p></div><div class="flex flex-col sm:flex-row justify-center items-stretch sm:items-center px-4 py-3 space-y-2 sm:space-y-0 sm:space-x-4"><button id="cancel-confirm-btn" class="px-4 py-2 bg-gray-200 rounded-md text-sm sm:text-base">Cancelar</button><button id="confirm-btn" class="px-4 py-2 bg-red-600 text-white rounded-md text-sm sm:text-base">Confirmar</button></div></div></div></div>
    <div id="edit-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center overflow-y-auto p-4"><div class="relative mx-auto p-6 sm:p-8 border w-full max-w-xl shadow-lg rounded-md bg-white"><h3 id="edit-modal-title" class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6"></h3><form id="edit-form" class="space-y-4"></form><div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center mt-4 sm:mt-6 space-y-2 sm:space-y-0 sm:space-x-4"><button id="cancel-edit-btn" class="px-4 py-2 bg-gray-200 rounded-md text-sm sm:text-base">Cancelar</button><button id="save-edit-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md text-sm sm:text-base">Guardar Cambios</button></div></div></div>
    <div id="historial-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full hidden z-50 flex items-center justify-center p-4"><div class="relative mx-auto p-6 sm:p-8 border w-full max-w-2xl shadow-lg rounded-md bg-white max-h-screen overflow-y-auto"><div class="flex justify-between items-start"><div><h3 class="text-xl sm:text-2xl font-semibold mb-2" id="historial-modal-title">Historial de Abonos</h3><p class="text-gray-600 text-sm" id="historial-modal-subtitle"></p></div><button id="cancel-historial-btn" class="p-2 -mt-4 -mr-4"><i class="fas fa-times text-gray-500"></i></button></div><div class="mt-4 sm:mt-6 overflow-y-auto max-h-96"><table class="w-full text-xs sm:text-sm"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="px-3 sm:px-4 py-3">Fecha</th><th class="px-3 sm:px-4 py-3">Hora</th><th class="px-3 sm:px-4 py-3">Monto Abonado</th><th class="px-3 sm:px-4 py-3">Recibido en</th></tr></thead><tbody id="historial-abonos-body"></tbody></table></div></div></div>

    <!-- Nuestro script local -->
    <script src="app.js" defer></script>
</body>
</html>

